# BIP39 TO PGP NOTES

## V1 Interface

_Inputs_

* BIP39 seed (12 words --> 128 bits/16 bytes of entropy).
* UserId (e.g. `John Doe <john.doe@gmail.com>`).

_Output_

* OpenPGP key encoded as OpenPGP packets.
* __Unencrypted__: User must encrypt the result using GPG tool.
* Keys do not expire, the user can set the expiration manually.
* Keys are self signed.

## Possible expansions

* Output key encoded with password (using pinentry for the passphrase).
* ASCII Armored Output.
* Use a stronger algorithm (e.g. Argon2id or BCrypt) to expand the 128 bits to 512.
* Expiration for keys.

## Tasks

1. Read list of words.
2. Decode the list of words using the dictionary.
3. Take the 128 bits of entropy and expand them to 512 bits.
    * Use SHA512 to expand the entropy.
    * Need 256 bits for the seed of signature key, and the rest for the encryption key.
4. Generate the public/private key for EdDSA using the entropy.
    * How to generate EdDSA using Rust?
    * Option 1: https://docs.rs/ed25519-dalek/latest/ed25519_dalek.
    * Option 2: Implement [RFC 8032](https://www.rfc-editor.org/rfc/rfc8032.html).
	* [Golang implementation](https://cs.opensource.google/go/go/+/refs/tags/go1.18.1:src/crypto/ed25519/ed25519.go;drc=b0c49ae9f59d233526f8934262c5bbbe14d4358d;l=123)
	* Requires SHA512 and fixed base scalar multiplication by the `B` generator.

```
------------------------------------------------------------------------------
5.1.5.  Key Generation

   The private key is 32 octets (256 bits, corresponding to b) of
   cryptographically secure random data.  See [RFC4086] for a discussion
   about randomness.

   The 32-byte public key is generated by the following steps.

   1.  Hash the 32-byte private key using SHA-512, storing the digest in
       a 64-octet large buffer, denoted h.  Only the lower 32 bytes are
       used for generating the public key.

   2.  Prune the buffer: The lowest three bits of the first octet are
       cleared, the highest bit of the last octet is cleared, and the
       second highest bit of the last octet is set.

   3.  Interpret the buffer as the little-endian integer, forming a
       secret scalar s.  Perform a fixed-base scalar multiplication
       [s]B.

   4.  The public key A is the encoding of the point [s]B.  First,
       encode the y-coordinate (in the range 0 <= y < p) as a little-
       endian string of 32 octets.  The most significant bit of the
       final octet is always zero.  To form the encoding of the point
       [s]B, copy the least significant bit of the x coordinate to the
       most significant bit of the final octet.  The result is the
       public key.
------------------------------------------------------------------------------
```

5. Output the corresponding PGP packets.

* Secret key packet.
* User ID packet, tag 13, eith the ID.
* Signature packet.

* [Signature Public key packet in passphrase2pgp](https://github.com/skeeto/passphrase2pgp/blob/99f508b3c25e56503cd771188eb565464ebc782f/openpgp/signkey.go#L127).
* [Signature Private key packet in passphrase2pgp](https://github.com/skeeto/passphrase2pgp/blob/99f508b3c25e56503cd771188eb565464ebc782f/openpgp/signkey.go#L149)

## PGP key Examples

### Example List Packets for a throwaway Curve 25519 key without password.

```
# off=0 ctb=94 tag=5 hlen=2 plen=88
:secret key packet:
        version 4, algo 22, created 1637784583, expires 0
        pkey[0]: [80 bits] ed25519 (1..6.1.4.1.11591.15.1)
        pkey[1]: [263 bits]
        skey[2]: [255 bits]
        checksum: 11cb
        keyid: E86764F01833CA22
# off=90 ctb=b4 tag=13 hlen=2 plen=38
:user ID packet: "Juan Pablo Darago <jpdarago@gmail.com>"
# off=130 ctb=88 tag=2 hlen=2 plen=144
:signature packet: algo 22, keyid E86764F01833CA22
        version 4, created 1637784583, md5len 0, sigclass 0x13
        digest algo 8, begin of digest 2d e9
        hashed subpkt 33 len 21 (issuer fpr v4 33E32C509FF054E319E3C423E86764F01833CA22)
        hashed subpkt 2 len 4 (sig created 2021-11-24)
        hashed subpkt 27 len 1 (key flags: 03)
        hashed subpkt 11 len 4 (pref-sym-algos: 9 8 7 2)
        hashed subpkt 21 len 5 (pref-hash-algos: 10 9 8 11 2)
        hashed subpkt 22 len 3 (pref-zip-algos: 2 3 1)
        hashed subpkt 30 len 1 (features: 01)
        hashed subpkt 23 len 1 (keyserver preferences: 80)
        subpkt 16 len 8 (issuer key ID E86764F01833CA22)
        data: [256 bits]
        data: [256 bits]
```

### Example List Packets for a throwaway Curve 25519 (ED25519) key with password.

```
# off=0 ctb=94 tag=5 hlen=2 plen=134
:secret key packet:
        version 4, algo 22, created 1637869917, expires 0
        pkey[0]: [80 bits] ed25519 (1.3.6.1.4.1.11591.15.1)
        pkey[1]: [263 bits]
        iter+salt S2K, algo: 7, SHA1 protection, hash: 2, salt: 7BDF5E597B923A62
        protect count: 65011712 (255)
        protect IV:  69 a3 bc 6d 5b de 85 b1 42 4d 9b 1f a6 d6 44 4a
        skey[2]: [v4 protected]
        keyid: 17BA2C6E2EC68D55
# off=136 ctb=b4 tag=13 hlen=2 plen=38
:user ID packet: "Juan Pablo Darago <jpdarago@gmail.com>"
# off=176 ctb=88 tag=2 hlen=2 plen=144
:signature packet: algo 22, keyid 17BA2C6E2EC68D55
        version 4, created 1637869917, md5len 0, sigclass 0x13
        digest algo 8, begin of digest 2e 5a
        hashed subpkt 33 len 21 (issuer fpr v4 E482D63532C89C9C33FE9C5717BA2C6E2EC68D55)
        hashed subpkt 2 len 4 (sig created 2021-11-25)
        hashed subpkt 27 len 1 (key flags: 03)
        hashed subpkt 11 len 4 (pref-sym-algos: 9 8 7 2)
        hashed subpkt 21 len 5 (pref-hash-algos: 10 9 8 11 2)
        hashed subpkt 22 len 3 (pref-zip-algos: 2 3 1)
        hashed subpkt 30 len 1 (features: 01)
        hashed subpkt 23 len 1 (keyserver preferences: 80)
        subpkt 16 len 8 (issuer key ID 17BA2C6E2EC68D55)
        data: [255 bits]
        data: [256 bits]
# off=322 ctb=9c tag=7 hlen=2 plen=139
:secret sub key packet:
        version 4, algo 18, created 1637869917, expires 0
        pkey[0]: [88 bits] cv25519 (1.3.6.1.4.1.3029.1.5.1)
        pkey[1]: [263 bits]
        pkey[2]: [32 bits]
        iter+salt S2K, algo: 7, SHA1 protection, hash: 2, salt: 636D9DBFDB52778C
        protect count: 65011712 (255)
        protect IV:  60 db 5b a2 05 4f d4 e8 ed c0 c3 a9 d8 ac 4b 63
        skey[3]: [v4 protected]
        keyid: 136D46F0079486BE
# off=463 ctb=88 tag=2 hlen=2 plen=120
:signature packet: algo 22, keyid 17BA2C6E2EC68D55
        version 4, created 1637869917, md5len 0, sigclass 0x18
        digest algo 8, begin of digest 96 bf
        hashed subpkt 33 len 21 (issuer fpr v4 E482D63532C89C9C33FE9C5717BA2C6E2EC68D55)
        hashed subpkt 2 len 4 (sig created 2021-11-25)
        hashed subpkt 27 len 1 (key flags: 0C)
        subpkt 16 len 8 (issuer key ID 17BA2C6E2EC68D55)
        data: [256 bits]
        data: [256 bits]
```

## Links

* [RFC4880 - OpenPGP packet spec](https://datatracker.ietf.org/doc/html/rfc4880#page-5)
* [RFC4880bis - OpenPGP ECC draft](https://tools.ietf.org/id/draft-ietf-openpgp-rfc4880bis-06.html).
* [Similar tool](https://github.com/skeeto/passphrase2pgp)
* [BIP39](https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki)
